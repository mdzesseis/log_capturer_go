# =============================================================================
# SSW LOGS CAPTURE GO - ENTERPRISE CONFIGURATION
# =============================================================================
# Complete configuration file showcasing all enterprise features including:
# - Advanced Security (Auth, Input Validation, Data Protection)
# - Distributed Tracing with OpenTelemetry
# - SLI/SLO Monitoring Framework
# - Resource Leak Detection
# - Advanced Observability
# =============================================================================

# -----------------------------------------------------------------------------
# APPLICATION CONFIGURATION
# -----------------------------------------------------------------------------
app:
  name: "ssw-logs-capture-enterprise"
  version: "v2.0.0"
  environment: "production"
  log_level: "info"
  log_format: "json"
  log_file: "/app/logs/application.log"
  operation_timeout: "1h"
  debug_mode: false

# -----------------------------------------------------------------------------
# SERVER CONFIGURATION
# -----------------------------------------------------------------------------
server:
  enabled: true
  port: 8401
  host: "0.0.0.0"
  read_timeout: "30s"
  write_timeout: "30s"
  idle_timeout: "60s"
  max_header_bytes: 1048576
  tls_enabled: true
  tls_cert_file: "/app/certs/server.crt"
  tls_key_file: "/app/certs/server.key"

# -----------------------------------------------------------------------------
# METRICS AND MONITORING
# -----------------------------------------------------------------------------
metrics:
  enabled: true
  port: 8001
  host: "0.0.0.0"
  path: "/metrics"
  collect_interval: "15s"
  retention_period: "7d"

# -----------------------------------------------------------------------------
# SECURITY CONFIGURATION (ENTERPRISE)
# -----------------------------------------------------------------------------
security:
  enabled: true

  authentication:
    enabled: true
    method: "basic"  # Options: basic, token, jwt
    session_timeout: "24h"
    max_attempts: 3
    lockout_time: "15m"
    users:
      admin:
        username: "admin"
        password_hash: "5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8"  # "password"
        roles: ["admin"]
        enabled: true
      operator:
        username: "operator"
        password_hash: "ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f"  # "secret123"
        roles: ["operator"]
        enabled: true
      viewer:
        username: "viewer"
        password_hash: "c6ba91b90d922e159893f46c387e5dc1b3dc5c101a5a4522f03b987177a24a91"  # "view123"
        roles: ["viewer"]
        enabled: true
    tokens:
      "enterprise-token-2024": "admin"
      "readonly-token-2024": "viewer"

  authorization:
    enabled: true
    default_role: "viewer"
    roles:
      admin:
        name: "admin"
        permissions:
          - resource: "*"
            action: "*"
      operator:
        name: "operator"
        permissions:
          - resource: "health"
            action: "read"
          - resource: "metrics"
            action: "read"
          - resource: "status"
            action: "read"
          - resource: "config"
            action: "read"
          - resource: "logs"
            action: "read"
          - resource: "monitoring"
            action: "read"
      viewer:
        name: "viewer"
        permissions:
          - resource: "health"
            action: "read"
          - resource: "metrics"
            action: "read"
          - resource: "status"
            action: "read"

  input_validation:
    enabled: true
    max_path_length: 4096
    max_string_length: 65536
    allowed_path_chars: "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_./"
    blocked_patterns:
      - "\\.\\."      # Path traversal
      - "/etc/"       # System directories
      - "/proc/"      # System directories
      - "/sys/"       # System directories
      - "/dev/"       # Device files
      - "/root/"      # Root home
      - "\\$\\{"      # Variable expansion
      - "`"           # Command execution
      - "\\|"         # Pipe commands
      - ";"           # Command separation
      - "&"           # Background execution
    require_absolute: true

  data_protection:
    enabled: true
    encryption_enabled: true
    encryption_key: "enterprise-key-2024-ssw-logs-capture-secure"
    pii_detection: true
    pii_patterns:
      - "\\b\\d{3}-\\d{2}-\\d{4}\\b"  # SSN
      - "\\b\\d{4}[\\s-]?\\d{4}[\\s-]?\\d{4}[\\s-]?\\d{4}\\b"  # Credit cards
      - "\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z|a-z]{2,}\\b"  # Email
      - "\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\b"  # IP addresses
    data_classification: true
    retention_policies:
      "public": "30d"
      "internal": "90d"
      "confidential": "1y"
      "restricted": "7y"

  audit:
    enabled: true
    log_file: "/app/logs/audit.log"
    log_level: "info"
    include_auth: true
    include_access: true
    include_config: true

# -----------------------------------------------------------------------------
# DISTRIBUTED TRACING (ENTERPRISE)
# -----------------------------------------------------------------------------
tracing:
  enabled: true
  service_name: "ssw-logs-capture"
  service_version: "v2.0.0"
  environment: "production"
  exporter: "otlp"  # Options: jaeger, otlp, console
  endpoint: "http://jaeger:4318/v1/traces"
  sample_rate: 1.0
  batch_timeout: "5s"
  max_batch_size: 512
  headers:
    "authorization": "Bearer YOUR_TRACE_TOKEN"

# -----------------------------------------------------------------------------
# SLI/SLO MONITORING (ENTERPRISE)
# -----------------------------------------------------------------------------
slo:
  enabled: true
  prometheus_url: "http://prometheus:9090"
  evaluation_interval: "1m"
  retention_period: "30d"
  alert_webhook: "http://alertmanager:9093/api/v1/alerts"

  slos:
    - name: "log_ingestion_availability"
      description: "Log ingestion service availability"
      error_budget: 0.1  # 99.9% availability
      window: "30d"
      alert_on_breach: true
      severity: "critical"
      slis:
        - name: "ingestion_success_rate"
          description: "Percentage of logs successfully ingested"
          query: "rate(logs_processed_total[5m]) / rate(logs_received_total[5m]) * 100"
          target: 99.9
          window: "5m"

    - name: "log_processing_performance"
      description: "Log processing performance"
      error_budget: 0.05  # 99.95% within SLA
      window: "7d"
      alert_on_breach: true
      severity: "high"
      slis:
        - name: "processing_latency_p99"
          description: "99th percentile processing latency"
          query: "histogram_quantile(0.99, processing_duration_seconds_bucket)"
          target: 100  # 100ms
          window: "5m"
        - name: "processing_latency_p95"
          description: "95th percentile processing latency"
          query: "histogram_quantile(0.95, processing_duration_seconds_bucket)"
          target: 50   # 50ms
          window: "5m"

    - name: "sink_delivery_reliability"
      description: "Sink delivery reliability"
      error_budget: 0.01  # 99.99% delivery success
      window: "24h"
      alert_on_breach: true
      severity: "critical"
      slis:
        - name: "sink_success_rate"
          description: "Percentage of successful sink deliveries"
          query: "rate(logs_sent_total{status=\"success\"}[5m]) / rate(logs_sent_total[5m]) * 100"
          target: 99.99
          window: "5m"

# -----------------------------------------------------------------------------
# RESOURCE MONITORING (ENTERPRISE)
# -----------------------------------------------------------------------------
resource_monitoring:
  enabled: true
  check_interval: "30s"
  goroutine_threshold: 1000
  memory_threshold_mb: 512
  fd_threshold: 1000
  alert_on_threshold: true
  alert_webhook_url: "http://alertmanager:9093/api/v1/alerts"

# -----------------------------------------------------------------------------
# GOROUTINE TRACKING (ENTERPRISE)
# -----------------------------------------------------------------------------
goroutine_tracking:
  enabled: true
  check_interval: "30s"
  leak_threshold: 100
  max_goroutines: 2000
  warn_threshold: 1000
  tracking_enabled: true
  stack_trace_on_leak: true
  alert_webhook: "http://alertmanager:9093/api/v1/alerts"
  retention_period: "24h"

# -----------------------------------------------------------------------------
# DISK CLEANUP (ENTERPRISE)
# -----------------------------------------------------------------------------
disk_cleanup:
  enabled: true
  check_interval: "5m"
  max_size_gb: 50
  warning_percent: 80
  cleanup_percent: 90
  retention_period: "7d"
  auto_cleanup: true
  cleanup_strategy: "oldest_first"

# -----------------------------------------------------------------------------
# ADVANCED OBSERVABILITY (ENTERPRISE)
# -----------------------------------------------------------------------------
observability:
  enabled: true
  enhanced_metrics: true
  performance_profiling: true
  health_check_advanced: true

  custom_metrics:
    business_logs_processed:
      name: "business_logs_processed_total"
      type: "counter"
      description: "Total business logs processed by tenant"
      labels: ["tenant_id", "log_type", "priority"]

    processing_cost:
      name: "processing_cost_per_gb"
      type: "gauge"
      description: "Processing cost per GB by tenant"
      labels: ["tenant_id", "cost_center"]

    response_time_detailed:
      name: "response_time_detailed_seconds"
      type: "histogram"
      description: "Detailed response time breakdown"
      labels: ["endpoint", "method", "tenant"]
      buckets: [0.001, 0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1.0, 2.5, 5.0]

  dashboards:
    - name: "enterprise_overview"
      type: "grafana"
      metrics: ["logs_processed_total", "processing_duration_seconds", "error_budget_remaining"]
      template: "/app/dashboards/enterprise_template.json"
      output: "/app/dashboards/generated/enterprise_dashboard.json"

  alerting:
    enabled: true

    rules:
      - name: "HighErrorRate"
        description: "Error rate is above 1%"
        query: "rate(errors_total[5m]) / rate(logs_processed_total[5m]) > 0.01"
        threshold: 0.01
        duration: "5m"
        severity: "warning"
        labels:
          team: "platform"
          service: "log-processor"
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value | humanizePercentage }}"

    webhooks:
      - name: "slack_alerts"
        url: "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"
        method: "POST"
        headers:
          "Content-Type": "application/json"
        template: |
          {
            "text": "ðŸš¨ Alert: {{ .GroupLabels.alertname }}",
            "attachments": [
              {
                "color": "danger",
                "fields": [
                  {
                    "title": "Summary",
                    "value": "{{ .CommonAnnotations.summary }}",
                    "short": false
                  }
                ]
              }
            ]
          }

    slack:
      enabled: true
      webhook_url: "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"
      channel: "#alerts"
      username: "Log Capturer"
      icon_url: "https://example.com/icon.png"

# -----------------------------------------------------------------------------
# FILE MONITORING
# -----------------------------------------------------------------------------
file_monitor_service:
  enabled: true
  poll_interval: "1s"
  read_buffer_size: 65536
  read_interval: "100ms"
  recursive: true
  follow_symlinks: false
  pipeline_file: "/app/configs/file_pipeline.yml"

files_config:
  watch_directories:
    - "/var/log"
    - "/app/logs"
  include_patterns:
    - "*.log"
    - "*.txt"
    - "*.json"
  exclude_patterns:
    - "*.gz"
    - "*.zip"
    - "*.tmp"
  exclude_directories:
    - "/var/log/monitoring_data"
    - "/app/logs/output"

# -----------------------------------------------------------------------------
# CONTAINER MONITORING
# -----------------------------------------------------------------------------
container_monitor:
  enabled: true
  socket_path: "unix:///var/run/docker.sock"
  max_concurrent: 50
  health_check_delay: "30s"
  reconnect_interval: "30s"
  include_stdout: true
  include_stderr: true
  follow: true
  include_labels:
    - "com.docker.compose.service"
    - "app.environment"
  exclude_labels:
    - "internal.monitoring"
  include_names:
    - "web-*"
    - "api-*"
  exclude_names:
    - "*-test"
    - "*-debug"

# -----------------------------------------------------------------------------
# LOG PROCESSING
# -----------------------------------------------------------------------------
processing:
  enabled: true
  pipelines_file: "/app/configs/pipelines.yaml"
  max_pipeline_depth: 10
  timeout: "30s"

# -----------------------------------------------------------------------------
# DISPATCHER CONFIGURATION
# -----------------------------------------------------------------------------
dispatcher:
  queue_size: 50000
  worker_count: 8
  batch_size: 500
  batch_timeout: "5s"
  max_retries: 3
  retry_base_delay: "1s"
  timestamp_tolerance: "24h"

  # Advanced features
  deduplication_enabled: true
  deduplication_config:
    enabled: true
    cache_size: 10000
    ttl: "1h"

  dlq_enabled: true
  dlq_config:
    directory: "/app/dlq"
    max_size_mb: 1000
    retention_period: "7d"

  backpressure_enabled: true
  backpressure_config:
    enabled: true
    high_threshold: 0.8
    critical_threshold: 0.95

  degradation_enabled: true
  degradation_config:
    enabled: true

  rate_limit_enabled: true
  rate_limit_config:
    enabled: true
    max_rate: 10000
    burst_size: 1000

# -----------------------------------------------------------------------------
# SINKS CONFIGURATION
# -----------------------------------------------------------------------------
sinks:
  loki:
    enabled: true
    url: "http://loki:3100"
    push_endpoint: "/loki/api/v1/push"
    batch_size: 1000
    batch_timeout: "10s"
    timeout: "30s"
    max_retries: 3
    retry_delay: "1s"
    compression_enabled: true
    compression_algorithm: "gzip"
    compression_level: 6

  local_file:
    enabled: true
    directory: "/app/logs/output"
    filename_pattern: "logs-{date}-{hour}.log"
    output_format: "json"
    max_file_size_mb: 100
    max_files: 100
    compress_rotated: true
    file_mode: "0644"
    create_directories: true

# -----------------------------------------------------------------------------
# POSITIONS MANAGEMENT
# -----------------------------------------------------------------------------
positions:
  enabled: true
  directory: "/app/data/positions"
  flush_interval: "30s"
  max_memory_buffer: 1000
  force_flush_on_exit: true
  cleanup_interval: "5m"
  max_position_age: "24h"

# -----------------------------------------------------------------------------
# DISK BUFFER
# -----------------------------------------------------------------------------
disk_buffer:
  enabled: true
  directory: "/app/data/buffer"
  max_file_size: 104857600  # 100MB
  max_total_size: 1073741824  # 1GB
  flush_interval: "5s"
  sync_interval: "30s"
  compression_enabled: true
  encryption_enabled: true
  retention_period: "24h"

# -----------------------------------------------------------------------------
# TIMESTAMP VALIDATION
# -----------------------------------------------------------------------------
timestamp_validation:
  enabled: true
  max_past_age_seconds: 86400    # 24 hours
  max_future_age_seconds: 3600   # 1 hour
  clamp_enabled: true
  clamp_dlq: false
  invalid_action: "clamp"        # "drop", "clamp", "forward"
  default_timezone: "UTC"
  accepted_formats:
    - "2006-01-02T15:04:05Z07:00"
    - "2006-01-02 15:04:05"
    - "Jan 02 15:04:05"

# -----------------------------------------------------------------------------
# ANOMALY DETECTION
# -----------------------------------------------------------------------------
anomaly_detection:
  enabled: true
  algorithms:
    - "statistical"
    - "ml_based"
  sensitivity: "medium"
  learning_period: "24h"
  alert_threshold: 0.8

# -----------------------------------------------------------------------------
# HOT RELOAD
# -----------------------------------------------------------------------------
hot_reload:
  enabled: true
  watch_files:
    - "/app/configs/config.yaml"
    - "/app/configs/pipelines.yaml"
  debounce_interval: "5s"

# =============================================================================
# END OF ENTERPRISE CONFIGURATION
# =============================================================================