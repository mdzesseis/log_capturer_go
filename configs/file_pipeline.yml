# =============================================================================
# SSW LOGS CAPTURE - FILE PIPELINE CONFIGURATION
# =============================================================================
# Este arquivo define arquivos e diretórios específicos para monitoramento
# Sobrescreve as configurações default de files_config em config.yaml
# =============================================================================

version: "1.0"

# -----------------------------------------------------------------------------
# ARQUIVOS ESPECÍFICOS PARA MONITORAMENTO
# -----------------------------------------------------------------------------
# Arquivos com caminho completo têm precedência sobre descoberta automática
# Se o arquivo não existir, gera WARNING no log mas não trava o serviço
files:
  # System logs
  - path: "/var/log/syslog"
    labels:
      log_type: "system"
      source: "syslog"
      severity: "info"
      team: "infrastructure"
    enabled: true

  - path: "/var/log/auth.log"
    labels:
      log_type: "security"
      source: "auth"
      severity: "warn"
      team: "security"
    enabled: true

  - path: "/var/log/kern.log"
    labels:
      log_type: "kernel"
      source: "kernel"
      severity: "info"
      team: "infrastructure"
    enabled: true

  # Web server logs (desabilitados por padrão)
  - path: "/var/log/nginx/access.log"
    labels:
      log_type: "web"
      source: "nginx"
      service: "web-server"
      log_format: "combined"
      team: "application"
    enabled: false

  - path: "/var/log/nginx/error.log"
    labels:
      log_type: "web"
      source: "nginx"
      service: "web-server"
      severity: "error"
      team: "application"
    enabled: false

  - path: "/var/log/apache2/access.log"
    labels:
      log_type: "web"
      source: "apache"
      service: "web-server"
      log_format: "combined"
      team: "application"
    enabled: false

  - path: "/var/log/apache2/error.log"
    labels:
      log_type: "web"
      source: "apache"
      service: "web-server"
      severity: "error"
      team: "application"
    enabled: false

  # Database logs (desabilitados por padrão)
  - path: "/var/log/mysql/error.log"
    labels:
      log_type: "database"
      source: "mysql"
      service: "database"
      severity: "error"
      team: "database"
    enabled: false

  - path: "/var/log/postgresql/postgresql.log"
    labels:
      log_type: "database"
      source: "postgresql"
      service: "database"
      team: "database"
    enabled: false

# -----------------------------------------------------------------------------
# DIRETÓRIOS PARA DESCOBERTA AUTOMÁTICA
# -----------------------------------------------------------------------------
# Monitora diretórios inteiros com padrões de inclusão/exclusão
# Arquivos descobertos recebem labels default configuradas aqui
directories:
  # Logs do sistema em /var/log (exclui próprios logs do capturer)
  - path: "/var/log"
    patterns:
      - "*.log"
      - "*_log"
      - "*.out"
      - "syslog*"
      - "messages*"
    exclude_patterns:
      - "*.gz"
      - "*.zip"
      - "*.old"
      - "*.bak"
      - "*~"
      - "*.1"
      - "*.2"
      - "*.3"
    exclude_directories:
      - "monitoring_data"      # Evita feedback loop
      - "journal"              # Logs binários do systemd
      - "private"              # Logs privados
    recursive: true
    default_labels:
      discovered: "true"
      log_type: "system"
      environment: "production"
    enabled: true

  # DESABILITADO - Logs da aplicação log_capturer (evita feedback loop)
  - path: "/app/logs"
    patterns:
      - "*.log"
      - "*.txt"
    exclude_patterns:
      - "*.gz"
      - "*.bak"
    recursive: false
    default_labels:
      discovered: "true"
      log_type: "application"
      service: "log-capturer"
    enabled: false

  # Logs customizados (adicione seus próprios diretórios aqui)
  # - path: "/opt/myapp/logs"
  #   patterns:
  #     - "*.log"
  #   exclude_patterns:
  #     - "*.gz"
  #   exclude_directories:
  #     - "archive"
  #   recursive: true
  #   default_labels:
  #     log_type: "application"
  #     service: "myapp"
  #     team: "myteam"
  #   enabled: true

# -----------------------------------------------------------------------------
# CONFIGURAÇÕES DE MONITORAMENTO
# -----------------------------------------------------------------------------
# Configurações específicas para o comportamento do file monitor
monitoring:
  # Intervalo de varredura de diretórios (segundos)
  directory_scan_interval: 30

  # Máximo de arquivos simultâneos monitorados
  max_files: 1000

  # Tamanho do buffer de leitura (bytes)
  read_buffer_size: 65536  # 64KB

  # Intervalo de polling para mudanças (milissegundos)
  poll_interval: 1000

  # Seguir links simbólicos
  follow_symlinks: false

  # Incluir arquivos ocultos (começando com .)
  include_hidden: false

  # Tamanho máximo de arquivo para monitorar (0 = ilimitado)
  max_file_size: 104857600  # 100MB

  # Ação quando arquivo é rotacionado (recreate, follow, ignore)
  rotation_action: "recreate"
