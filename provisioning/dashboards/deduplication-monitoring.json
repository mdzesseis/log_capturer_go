{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "gnetId": null,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "Duplicate Rate (%)",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 20,
            "gradientMode": "none",
            "hideFrom": {
              "tooltip": false,
              "viz": false,
              "legend": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "line"
            }
          },
          "mappings": [],
          "max": 100,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 15
              },
              {
                "color": "orange",
                "value": 25
              },
              {
                "color": "red",
                "value": 30
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "options": {
        "legend": {
          "calcs": ["last", "mean", "max"],
          "displayMode": "table",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "pluginVersion": "8.0.0",
      "targets": [
        {
          "expr": "log_capturer_deduplication_duplicate_rate * 100",
          "refId": "A",
          "legendFormat": "Duplicate Rate"
        }
      ],
      "title": "Duplicate Detection Rate (Expected: 5-15%)",
      "type": "timeseries",
      "description": "Percentage of logs detected as duplicates. Typical values: Container logs 5-15%, File logs 2-5%, Application logs 1-3%."
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "max": 100000,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 70000
              },
              {
                "color": "orange",
                "value": 85000
              },
              {
                "color": "red",
                "value": 95000
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 12,
        "y": 0
      },
      "id": 2,
      "options": {
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "calcs": ["lastNotNull"],
          "fields": ""
        },
        "showThresholdLabels": false,
        "showThresholdMarkers": true,
        "text": {}
      },
      "pluginVersion": "8.0.0",
      "targets": [
        {
          "expr": "log_capturer_deduplication_cache_size",
          "refId": "A",
          "legendFormat": "Cache Size"
        }
      ],
      "title": "Deduplication Cache Size (Max: 100,000)",
      "type": "gauge",
      "description": "Current number of entries in the deduplication cache. When approaching max (100k), cache evictions will increase."
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "Hit Rate (%)",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 20,
            "gradientMode": "opacity",
            "hideFrom": {
              "tooltip": false,
              "viz": false,
              "legend": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "max": 100,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": null
              },
              {
                "color": "orange",
                "value": 50
              },
              {
                "color": "yellow",
                "value": 70
              },
              {
                "color": "green",
                "value": 80
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 9
      },
      "id": 3,
      "options": {
        "legend": {
          "calcs": ["last", "mean", "min"],
          "displayMode": "table",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "pluginVersion": "8.0.0",
      "targets": [
        {
          "expr": "log_capturer_deduplication_cache_hit_rate * 100",
          "refId": "A",
          "legendFormat": "Cache Hit Rate"
        }
      ],
      "title": "Cache Hit Rate (Expected: 70-90%)",
      "type": "timeseries",
      "description": "Percentage of lookups that find an existing entry in cache. Higher is better, indicates good cache utilization."
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "Evictions/sec",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "bars",
            "fillOpacity": 50,
            "gradientMode": "none",
            "hideFrom": {
              "tooltip": false,
              "viz": false,
              "legend": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 50
              },
              {
                "color": "red",
                "value": 100
              }
            ]
          },
          "unit": "ops"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 12,
        "y": 9
      },
      "id": 4,
      "options": {
        "legend": {
          "calcs": ["last", "mean", "sum"],
          "displayMode": "table",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "pluginVersion": "8.0.0",
      "targets": [
        {
          "expr": "rate(log_capturer_deduplication_cache_evictions_total[5m])",
          "refId": "A",
          "legendFormat": "Eviction Rate"
        }
      ],
      "title": "Cache Eviction Rate (Expected: <1% of checks)",
      "type": "timeseries",
      "description": "Rate of cache evictions (LRU or TTL expiration). High eviction rate may indicate cache is too small or TTL is too short."
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "Duplicates Filtered/sec",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "opacity",
            "hideFrom": {
              "tooltip": false,
              "viz": false,
              "legend": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "normal"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "ops"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 24,
        "x": 0,
        "y": 18
      },
      "id": 5,
      "options": {
        "legend": {
          "calcs": ["last", "mean", "sum"],
          "displayMode": "table",
          "placement": "right"
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "pluginVersion": "8.0.0",
      "targets": [
        {
          "expr": "rate(log_capturer_logs_deduplicated_total[5m])",
          "refId": "A",
          "legendFormat": "{{source_type}} - {{source_id}}"
        }
      ],
      "title": "Duplicates Filtered by Source",
      "type": "timeseries",
      "description": "Rate of duplicate logs filtered by source type and ID. Shows which sources produce the most duplicates."
    },
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "Memory (MB)",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "tooltip": false,
              "viz": false,
              "legend": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "line"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 11
              },
              {
                "color": "red",
                "value": 13
              }
            ]
          },
          "unit": "decmbytes"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 0,
        "y": 27
      },
      "id": 6,
      "options": {
        "legend": {
          "calcs": ["last", "max"],
          "displayMode": "table",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "pluginVersion": "8.0.0",
      "targets": [
        {
          "expr": "(log_capturer_deduplication_cache_size * 114) / 1048576",
          "refId": "A",
          "legendFormat": "Estimated Memory Usage"
        }
      ],
      "title": "Estimated Deduplication Memory Usage (Max ~13.4 MB)",
      "type": "timeseries",
      "description": "Estimated memory used by deduplication cache (114 bytes per entry + 2MB map overhead)."
    },
    {
      "datasource": "Prometheus",
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 12,
        "y": 27
      },
      "id": 7,
      "options": {
        "content": "# Deduplication System Overview\n\n## Algorithm: xxHash (20x faster than SHA256)\n\n## Cache Strategy: LRU + TTL\n- **Max Size**: 100,000 entries (~13 MB RAM)\n- **TTL**: 10 seconds (configurable)\n- **Cleanup**: Every 1 second\n\n## Hash Inputs (configurable):\n- Message content (always)\n- Source ID (default: true)\n- Timestamp (default: false)\n\n## Expected Metrics:\n- **Duplicate Rate**: 5-15% (container logs), 2-5% (file logs), 1-3% (app logs)\n- **Hit Rate**: 70-90% (good cache utilization)\n- **Evictions**: <1% of total checks\n\n## Performance:\n- **Latency**: ~25 ns per check (O(1))\n- **Throughput**: ~40M checks/second/core (theoretical)\n- **CPU Overhead**: 0.025% @ 10k logs/sec\n\n## Tuning:\nEdit `config.yaml` â†’ `dispatcher.deduplication_config`\n\n## Alerts:\n- Duplicate rate > 30% (warning)\n- Cache > 95% full for 30min (warning)\n- Eviction rate > 100/sec for 15min (info)",
        "mode": "markdown"
      },
      "pluginVersion": "8.0.0",
      "title": "Deduplication System Info",
      "type": "text"
    }
  ],
  "refresh": "30s",
  "schemaVersion": 27,
  "style": "dark",
  "tags": ["deduplication", "log-capturer", "performance"],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "",
  "title": "Log Capturer - Deduplication Monitoring",
  "uid": "log-capturer-deduplication",
  "version": 1
}
